# LASTTRADE 자동매매 시스템 (Kiwoom REST Bot)

**LASTTRADE**는 키움증권 REST API를 활용한 원격 제어 및 원칙 기반 자동매매 시스템입니다.

---

##  시스템 핵심 설계 (System Architecture)

- ✅ **70% 운영 룰**: 전체 자산의 70%만 주식 매수에 사용 (30% 예비비 확보)
- ✅ **1:1:2:2:4 수열**: 5단계 고정 가중치 분할 매수 시스템
- ✅ **WATER(물타기) 집중**: 평단가 관리 전략 최적화 (MAX 단계 후 손절 원칙)
- ✅ **하이브리드 엔진**: 키움 REST API + WebSocket 실시간 포착 + AI 수학적 분석

---

## 📋 주요 기능

### 핵심 기능
- ✅ **자산 70% 운용 룰**: 전체 자산(예수금+평가금)의 70%만 투자에 사용 (안전마진 30%)
- ✅ **유연한 분할 매수**: 설정된 종목 수와 관계없이 분할 매수 및 물타기/불타기 전략 적용 가능
    - **FIRE (불타기)**: 수익 중일 때 추가 매수
    - **WATER (물타기)**: 손실 중일 때 추가 매수
- ✅ **키움 REST API 연동**: 모의투자/실전투자 지원
- ✅ **WebSocket 실시간 대응**: 조건검색 실시간 포착 및 즉시 주문
- ✅ **텔레그램 봇 제어**: 언제 어디서나 봇 상태 확인 및 제어

### 매매 로직 상세
- **매수**: 조건검색 종목 포착 -> 자산 70% 한도 체크 -> 종목별 배정액 계산 -> 분할 매수 체크 -> 주문
- **매도**: 
    - 익절(Take Profit): 설정된 수익률 도달 시 자동 매도
    - 손절(Stop Loss): 설정된 손실률 도달 시 자동 매도
    - **전량 매도**: 텔레그램 명령어로 즉시 청산 가능

### 안정성 기능
- ✅ 파일 로깅 시스템 (일반 로그 + 에러 로그 분리)
- ✅ 설정 값 자동 검증
- ✅ 중복 실행 방지 (Lock 파일)
- ✅ WebSocket 자동 재연결 및 상태 모니터링
- ✅ 비동기 처리 (aiohttp, asyncio)로 매끄러운 동작

---

##  시작하기

### 1. 필수 요구사항
- Python 3.9+
- 키움증권 계좌 (모의투자 또는 실전투자)
- 텔레그램 봇 토큰

### 2. 설치
```bash
pip install aiohttp websockets requests
```

### 3. 설정 파일 수정
- `config.py`: API 키 및 텔레그램 봇 정보 설정
- `settings.json`: 매매 모드, 익절/손절 기준 등 설정

### 4. 실행
```bash
python main.py
```

---

## 📱 텔레그램 명령어

- `start` / `stop` - 봇 가동 제어
- `report` (또는 `r`) - 계좌평가현황 보고
- `goal {금액}` - 일일 목표 수익금 설정
- `limit {숫자}` - 일일 손실 한도 설정
- `tpr {숫자}` / `slr {숫자}` - 익절/손절 기준 실시간 변경

---

## ⚠️ 주의사항

1. **실전투자 전 충분한 테스트 필수**: 모의투자로 충분히 테스트 후 실전투자 진행
2. **API 키 보안**: `config.py` 파일은 절대 외부에 노출하지 마세요.
3. **중복 실행 방지**: 프로그램이 이미 실행 중이면 새로 실행되지 않습니다.

---

## 📚 시스템 문서 보관소 (System Documentation)

본 프로젝트의 상세 원칙과 기술 명세는 아래 문서들을 참고하십시오. **AI 모델과 개발자는 반드시 'LASTTRADE 개발 대원칙'을 최우선으로 숙지해야 합니다.**

### � 1. [필독] LASTTRADE 개발 대원칙
- **[LASTTRADE_PRINCIPLES.md](LASTTRADE_PRINCIPLES.md)**: 시스템의 심장이자 최상위 가이드라인. 자금 관리, 수열, 리스크 관리 원칙 수록.

### 📋 2. 상세 기술 가이드
- **[📊 LASTTRADE 설정 팩터 기술서](LASTTRADE_FACTOR_DOC.md)**: 모든 파라미터의 상세 명세 및 코드 적용 위치
- **[🔥 LASTTRADE 전략 가이드](LASTTRADE_STRATEGY_GUIDE.md)**: 불타기(FIRE)와 물타기(WATER)의 매커니즘 설명
- **[� LASTTRADE 미체결 로직 기술서](LASTTRADE_PENDING_LOGIC.md)**: 주문 충돌 방지 및 안전한 주문 처리 프로세스
- **[🎮 LASTTRADE 가상서버 가이드](LASTTRADE_MOCK_SERVER_GUIDE.md)**: Mock Server 활용법 및 시뮬레이션 방법
- **[🔧 LASTTRADE 트러블슈팅 가이드](LASTTRADE_TROUBLESHOOTING.md)**: 문제 발생 시 대응 절차

---

## 📝 라이선스 및 개발자
- **라이선스**: 이 프로젝트는 개인 학습 및 연구 목적으로 제작되었습니다.
- **개발자**: AI Assistant & Developer
- **⚠️ 면책 조항**: 투자 책임은 본인에게 있습니다. 이 프로그램 사용으로 인한 손실에 대해 개발자는 책임지지 않습니다.

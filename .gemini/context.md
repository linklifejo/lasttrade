# í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸

---

## ğŸ“Œ **í”„ë¡œì íŠ¸ ê°œìš”**

**í”„ë¡œì íŠ¸ëª…:** í‚¤ì›€ì¦ê¶Œ ìë™ë§¤ë§¤ ë´‡ (Kiwoom Auto Trading Bot)

**ëª©ì :** í‚¤ì›€ì¦ê¶Œ REST APIë¥¼ í™œìš©í•œ ìë™ë§¤ë§¤ ì‹œìŠ¤í…œ êµ¬ì¶•

**í•µì‹¬ ì „ëµ:**
- ë¶ˆíƒ€ê¸° (FIRE): ìˆ˜ìµ ì¤‘ì¼ ë•Œ ì¶”ê°€ ë§¤ìˆ˜
- ë¬¼íƒ€ê¸° (WATER): ì†ì‹¤ ì¤‘ì¼ ë•Œ ì¶”ê°€ ë§¤ìˆ˜

---

## ğŸ¯ **ìµœê·¼ ì£¼ìš” ì—…ë°ì´íŠ¸ (2025-12-26)**

### **1. ì „ëµë³„ ìë™ ì„¤ì • ì‹œìŠ¤í…œ êµ¬ì¶•**
```
êµ¬í˜„ ë‚´ìš©:
  - settings_ui.pyì— í”„ë¦¬ì…‹ ë²„íŠ¼ ì¶”ê°€
  - ë¶ˆíƒ€ê¸°/ë¬¼íƒ€ê¸° ì„ íƒ ì‹œ ëª¨ë“  íŒ©í„° ìë™ ì ìš©
  - 4ê°€ì§€ í”„ë¦¬ì…‹: ëª°ë¹µ ë¬¼íƒ€ê¸°, ëª°ë¹µ ë¶ˆíƒ€ê¸°, ë¶„ì‚° ë¬¼íƒ€ê¸°, ë¶„ì‚° ë¶ˆíƒ€ê¸°
```

### **2. ì´ˆê¸° ë§¤ìˆ˜ ë¹„ìœ¨ (initial_buy_ratio) ì¶”ê°€**
```
ëª©ì :
  - 1ì°¨ ë§¤ìˆ˜ ì‹œ ì¢…ëª©ë‹¹ í• ë‹¹ ê¸ˆì•¡ì˜ ì¼ì • ë¹„ìœ¨ë§Œ ì‚¬ìš©
  - ë¦¬ìŠ¤í¬ ìµœì†Œí™” ë° ì¶”ê°€ ë§¤ìˆ˜ ì—¬ë ¥ í™•ë³´

ì„¤ì •:
  - ê¸°ë³¸ê°’: 10%
  - ë¶ˆíƒ€ê¸°: 10% í…ŒìŠ¤íŠ¸ â†’ +3% ë‹¬ì„± â†’ 90% ì§‘ì¤‘
  - ë¬¼íƒ€ê¸°: 10% ì‹œì‘ â†’ -1% í•˜ë½ ì‹œë§ˆë‹¤ ì¶”ê°€ 10%

ì½”ë“œ ìœ„ì¹˜:
  - settings_ui.py: UI í•„ë“œ ì¶”ê°€
  - check_n_buy.py: ë§¤ìˆ˜ ë¡œì§ ì ìš©
```

### **3. ë¶ˆíƒ€ê¸° ì „ëµ ìµœì í™”**
```
ë³€ê²½ ì‚¬í•­:
  - split_buy_cnt: 3íšŒ â†’ 2íšŒ (ë¹ ë¥¸ ì§‘ì¤‘)
  - initial_buy_ratio: ì‹ ê·œ ì¶”ê°€ (10%)
  - single_stock_rate: 1.0% â†’ 3.0% (í™•ì‹¤í•œ ì¶”ì„¸ í™•ì¸)
  - stop_loss_rate: -10% â†’ -5% (ë¹ ë¥¸ ì†ì ˆ)
  - trailing_stop_callback_rate: 0.7% â†’ 0.5% (ë¹ ë¥¸ ìµì ˆ)

ê²°ê³¼:
  - 1ì°¨ ë§¤ìˆ˜: 10% (í…ŒìŠ¤íŠ¸)
  - 2ì°¨ ë§¤ìˆ˜: 90% (í™•ì‹ )
  - TSë¡œ ìˆ˜ìµ ê·¹ëŒ€í™”
```

### **4. ë¬¼íƒ€ê¸° ì „ëµ ìµœì í™”**
```
ë³€ê²½ ì‚¬í•­:
  - split_buy_cnt: 3íšŒ â†’ 10íšŒ (ì„¸ë°€í•œ ë¶„í• )
  - initial_buy_ratio: ì‹ ê·œ ì¶”ê°€ (10%)
  - single_stock_rate: 1.5% â†’ 1.0% (ë¹ ë¥¸ í‰ë‹¨ê°€ ì¡°ì •)
  - stop_loss_rate: -4% â†’ -10% (ë§¤ì§‘ ë³´í˜¸)

ê²°ê³¼:
  - 1~10ì°¨ ë§¤ìˆ˜: ê° 10%
  - -1% í•˜ë½ ì‹œë§ˆë‹¤ ì¶”ê°€ ë§¤ìˆ˜
  - í‰ë‹¨ê°€ ë‚®ì¶¤ â†’ ë°˜ë“± ì‹œ ìµì ˆ
```

### **5. ê¸°ìˆ  ë¬¸ì„œ ì‘ì„±**
```
ì‘ì„± ë¬¸ì„œ:
  1. ì „ëµë³„_ì„¤ì •_íŒ©í„°_ê¸°ìˆ ì„œ.md
     â””â”€ ëª¨ë“  íŒ©í„°ì˜ ì˜ë¯¸, ì½”ë“œ ìœ„ì¹˜, ìƒí˜¸ì‘ìš©

  2. ë¶ˆíƒ€ê¸°_ë¬¼íƒ€ê¸°_ì „ëµ_ê°€ì´ë“œ.md
     â””â”€ ì „ëµ ê°œìš”, í”„ë¦¬ì…‹, ì‹¤ì „ ì˜ˆì‹œ

  3. ë¯¸ì²´ê²°_ë¡œì§_ê¸°ìˆ ì„œ.md
     â””â”€ ì£¼ë¬¸ ì²˜ë¦¬ ë° ì¶©ëŒ ë°©ì§€ ë¡œì§

  4. README.md ì—…ë°ì´íŠ¸
     â””â”€ AI ëª¨ë¸ìš© í•„ìˆ˜ ë¬¸ì„œ ì„¹ì…˜ ì¶”ê°€
```

---

## ğŸ”‘ **í•µì‹¬ ì„¤ê³„ ì›ì¹™**

### **1. ì„¤ì • ìš°ì„ ìˆœìœ„**
```
DB (trading.db) > ê¸°ë³¸ê°’
  â””â”€ get_setting() / cached_setting()ìœ¼ë¡œ ë™ì  ë¡œë“œ
  â””â”€ UI ë³€ê²½ ì‹œ ì¦‰ì‹œ ë°˜ì˜
```

### **2. ì „ëµë³„ í”„ë¦¬ì…‹**
```
í”„ë¦¬ì…‹ ì„ íƒ ì‹œ ìë™ ì ìš©:
  - split_buy_cnt
  - initial_buy_ratio
  - single_stock_strategy
  - single_stock_rate
  - stop_loss_rate
  - take_profit_rate
  - trailing_stop_activation_rate
  - trailing_stop_callback_rate
  - time_cut_minutes
  - time_cut_profit
```

### **3. ë¯¸ì²´ê²° ì£¼ë¬¸ ê´€ë¦¬**
```
stocks_being_sold ì„¸íŠ¸:
  - ë§¤ë„ ì£¼ë¬¸ ì „ì†¡ ì‹œ ì¶”ê°€
  - ë§¤ë„ ì™„ë£Œ ì‹œ ì œê±°
  - ë§¤ìˆ˜ ë¡œì§ì—ì„œ ì²´í¬ (ë§¤ë„ ì¤‘ ì¢…ëª© ë§¤ìˆ˜ ê¸ˆì§€)
```

### **4. ì´ˆê¸° ë§¤ìˆ˜ ë¹„ìœ¨**
```
ê³„ì‚°ì‹:
  one_shot_amt = alloc_per_stock Ã— cumulative_ratios[0] Ã— initial_buy_ratio

ì˜ˆì‹œ (ë¶ˆíƒ€ê¸°):
  alloc_per_stock = 200ë§Œì›
  cumulative_ratios[0] = 50% (2íšŒ ë¶„í•  ì‹œ)
  initial_buy_ratio = 10%
  
  1ì°¨ ë§¤ìˆ˜ = 200ë§Œ Ã— 50% Ã— 10% = 10ë§Œì›
  2ì°¨ ë§¤ìˆ˜ = 200ë§Œ - 10ë§Œ = 190ë§Œì›
```

---

## ğŸ“Š **í˜„ì¬ í”„ë¦¬ì…‹ ì„¤ì •ê°’**

### **ëª°ë¹µ ë¶ˆíƒ€ê¸° (1ì¢…ëª© ì§‘ì¤‘)**
```python
target_stock_count = 1
split_buy_cnt = 2
initial_buy_ratio = 10.0
single_stock_strategy = "FIRE"
single_stock_rate = 3.0
stop_loss_rate = -5.0
take_profit_rate = 10.0
trailing_stop_activation_rate = 1.5
trailing_stop_callback_rate = 0.5
time_cut_minutes = 30
time_cut_profit = 1.0
```

### **ë¶„ì‚° ë¶ˆíƒ€ê¸° (5ì¢…ëª© ë¶„ì‚°)** â­ ì¶”ì²œ
```python
target_stock_count = 5
split_buy_cnt = 2
initial_buy_ratio = 10.0
single_stock_strategy = "FIRE"
single_stock_rate = 3.0
stop_loss_rate = -5.0
take_profit_rate = 10.0
trailing_stop_activation_rate = 1.5
trailing_stop_callback_rate = 0.5
time_cut_minutes = 30
time_cut_profit = 1.0
```

### **ëª°ë¹µ ë¬¼íƒ€ê¸° (1ì¢…ëª© ì§‘ì¤‘)**
```python
target_stock_count = 1
split_buy_cnt = 10
initial_buy_ratio = 10.0
single_stock_strategy = "WATER"
single_stock_rate = 1.0
stop_loss_rate = -10.0
take_profit_rate = 2.5
trailing_stop_activation_rate = 1.5
trailing_stop_callback_rate = 0.7
time_cut_minutes = 5
time_cut_profit = 0.3
```

### **ë¶„ì‚° ë¬¼íƒ€ê¸° (5ì¢…ëª© ë¶„ì‚°)**
```python
target_stock_count = 5
split_buy_cnt = 10
initial_buy_ratio = 10.0
single_stock_strategy = "WATER"
single_stock_rate = 1.0
stop_loss_rate = -10.0
take_profit_rate = 3.5
trailing_stop_activation_rate = 2.0
trailing_stop_callback_rate = 1.0
time_cut_minutes = 15
time_cut_profit = 0.5
```

---

## ğŸ” **ì£¼ìš” ì½”ë“œ ë³€ê²½ ì´ë ¥**

### **settings_ui.py**
```
Line 98-154: í”„ë¦¬ì…‹ ì„¤ì •ê°’ ì—…ë°ì´íŠ¸
  - ë¶ˆíƒ€ê¸°: split_buy_cnt=2, initial_buy_ratio=10.0
  - ë¬¼íƒ€ê¸°: split_buy_cnt=10, initial_buy_ratio=10.0

Line 256-262: initial_buy_ratio í•„ë“œ ì¶”ê°€
  - ì˜µì…˜: [10.0, 20.0, 25.0, 30.0, 33.3, 50.0, 100.0]
```

### **check_n_buy.py**
```
Line 312-316: initial_buy_ratio ë¡œë“œ ë° ì ìš©
  - initial_buy_ratio = float(get_setting('initial_buy_ratio', 10.0)) / 100.0
  - target_ratio_1st = cumulative_ratios[0] * initial_buy_ratio
  - one_shot_amt = alloc_per_stock * target_ratio_1st

Line 329: ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
  - msg_reason = f"ì‹ ê·œ ë§¤ìˆ˜ (ì´ˆê¸° {initial_buy_ratio*100:.0f}%)"
```

### **check_n_sell.py**
```
Line 151-167: ë¬¼íƒ€ê¸° ì†ì ˆ ë³´í˜¸ ë¡œì§
  - ë§¤ì§‘ ì¤‘ (pchs_amt < alloc_per_stock * 0.95) ì†ì ˆ ìŠ¤í‚µ
  - ë§¤ì§‘ ì™„ë£Œ í›„ì—ë§Œ ì†ì ˆ ì‹¤í–‰

Line 174-195: íŠ¸ë ˆì¼ë§ ìŠ¤íƒ‘ ë¡œì§
  - TS_ACTIVATION ì´ìƒ ì‹œ ê³ ì  ê¸°ë¡
  - TS_CALLBACK í•˜ë½ ì‹œ ìµì ˆ
```

---

## âš ï¸ **ì•Œë ¤ì§„ ì´ìŠˆ ë° ì œì•½ì‚¬í•­**

### **1. Mock Account Cash Balance**
```
ë¬¸ì œ: ëª¨ì˜íˆ¬ì ê³„ì¢Œ ì”ê³  ìŒìˆ˜
í•´ê²°: ì‚¬ìš©ìê°€ ëª¨ì˜íˆ¬ì ê³„ì¢Œ ë¦¬ì…‹ í•„ìš”
```

### **2. API Rate Limiting (Error 1700)**
```
ë¬¸ì œ: ê³¼ë„í•œ API í˜¸ì¶œ ì‹œ ì œí•œ
í•´ê²°: Retry ë¡œì§ êµ¬í˜„ (kiwoom/real_api.py)
```

### **3. í”„ë¦¬ì…‹ ë³€ê²½ í›„ ì¬ì‹œì‘**
```
ê¶Œì¥: í”„ë¦¬ì…‹ ë³€ê²½ í›„ ë´‡ ì¬ì‹œì‘
ì´ìœ : ì¼ë¶€ ì„¤ì •ì€ ì´ˆê¸°í™” ì‹œì—ë§Œ ë¡œë“œ
```

---

## ğŸ“ **ë‹¤ìŒ ë‹¨ê³„**

### **1. í…ŒìŠ¤íŠ¸ í•„ìš” í•­ëª©**
```
- initial_buy_ratio ì ìš© í™•ì¸
- í”„ë¦¬ì…‹ ìë™ ì„¤ì • ë™ì‘ í™•ì¸
- ë¶ˆíƒ€ê¸° 2íšŒ ë¶„í•  ë™ì‘ í™•ì¸
- ë¬¼íƒ€ê¸° 10íšŒ ë¶„í•  ë™ì‘ í™•ì¸
```

### **2. ë¬¸ì„œ ê²€í† **
```
- ì „ëµë³„_ì„¤ì •_íŒ©í„°_ê¸°ìˆ ì„œ.md
- ë¶ˆíƒ€ê¸°_ë¬¼íƒ€ê¸°_ì „ëµ_ê°€ì´ë“œ.md
- ë¯¸ì²´ê²°_ë¡œì§_ê¸°ìˆ ì„œ.md
```

### **3. ëª¨ë‹ˆí„°ë§**
```
- ë§¤ìˆ˜/ë§¤ë„ ë¡œê·¸ í™•ì¸
- ì„¤ì •ê°’ ë°˜ì˜ ì—¬ë¶€ í™•ì¸
- TS ë™ì‘ í™•ì¸
```

---

## ğŸ¤– **AI ëª¨ë¸ì„ ìœ„í•œ ê°€ì´ë“œ**

### **â­ ì¸ìˆ˜ì¸ê³„ ì‹œ í•„ìˆ˜ ì ˆì°¨:**
```
ìƒˆë¡œìš´ AI ëª¨ë¸ì´ í”„ë¡œì íŠ¸ë¥¼ ì¸ìˆ˜ë°›ì„ ë•Œ:

1. í•„ìˆ˜ ë¬¸ì„œ ì½ê¸° (ìˆœì„œëŒ€ë¡œ)
   âœ… ì „ëµë³„_ì„¤ì •_íŒ©í„°_ê¸°ìˆ ì„œ.md
   âœ… ë¶ˆíƒ€ê¸°_ë¬¼íƒ€ê¸°_ì „ëµ_ê°€ì´ë“œ.md
   âœ… ë¯¸ì²´ê²°_ë¡œì§_ê¸°ìˆ ì„œ.md
   âœ… íŠ¸ëŸ¬ë¸”ìŠˆíŒ…_ê°€ì´ë“œ.md
   âœ… README.md

2. .gemini ë””ë ‰í† ë¦¬ ë¬¸ì„œ ì½ê¸°
   âœ… .gemini/rules.md (ê·œì¹™ - ìµœìš°ì„ )
   âœ… .gemini/context.md (í˜„ì¬ ë¬¸ì„œ)
   âœ… .gemini/project_guide.md (ê°€ì´ë“œ)

3. í•µì‹¬ ì†ŒìŠ¤ íŒŒì¼ íŒŒì•…
   âœ… check_n_buy.py (ë§¤ìˆ˜ ë¡œì§)
   âœ… check_n_sell.py (ë§¤ë„ ë¡œì§)
   âœ… settings_ui.py (ì„¤ì • UI ë° í”„ë¦¬ì…‹)
   âœ… bot.py (ë©”ì¸ ë£¨í”„)

4. ì‚¬ìš©ìì—ê²Œ í•™ìŠµ ì™„ë£Œ ë³´ê³ 
   "ë¬¸ì„œ ë° ì†ŒìŠ¤ í•™ìŠµ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤"

5. ìˆ˜ì • í•„ìš” ì‹œ ë°˜ë“œì‹œ ì‚¬ìš©ì í—ˆë½ ë“í•¨
   - ìˆ˜ì • ë‚´ìš©, ì´ìœ , ì˜í–¥ ë²”ìœ„ ì„¤ëª…
   - ì‚¬ìš©ì ìŠ¹ì¸ ëŒ€ê¸°
   - ìŠ¹ì¸ í›„ ì‘ì—… ì§„í–‰
```

### **í”„ë¡œì íŠ¸ ì ‘ê·¼ ì‹œ ìˆœì„œ:**
```
1. .gemini/rules.md ì½ê¸° (ìµœìš°ì„  - ê·œì¹™ ìˆ™ì§€)
2. ì „ëµë³„_ì„¤ì •_íŒ©í„°_ê¸°ìˆ ì„œ.md ì½ê¸°
3. ë¶ˆíƒ€ê¸°_ë¬¼íƒ€ê¸°_ì „ëµ_ê°€ì´ë“œ.md ì½ê¸°
4. ë¯¸ì²´ê²°_ë¡œì§_ê¸°ìˆ ì„œ.md ì½ê¸°
5. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…_ê°€ì´ë“œ.md ì½ê¸°
6. README.md ì½ê¸°
7. í•µì‹¬ ì†ŒìŠ¤ íŒŒì•…
8. ì‚¬ìš©ìì—ê²Œ í•™ìŠµ ì™„ë£Œ ë³´ê³ 
9. ì½”ë“œ ìˆ˜ì • ì‹œì‘ (ì‚¬ìš©ì ìŠ¹ì¸ í•„ìˆ˜)
```

### **ì½”ë“œ ìˆ˜ì • ì‹œ ì²´í¬ë¦¬ìŠ¤íŠ¸:**
```
â–¡ .gemini/rules.md ì½ìŒ (ê·œì¹™ í™•ì¸)
â–¡ ê´€ë ¨ ê¸°ìˆ  ë¬¸ì„œ í™•ì¸
â–¡ íŒ©í„° ê°„ ìƒí˜¸ì‘ìš© í™•ì¸
â–¡ í”„ë¦¬ì…‹ ê°’ê³¼ì˜ ì¼ê´€ì„± í™•ì¸
â–¡ ë¯¸ì²´ê²° ì£¼ë¬¸ ê´€ë¦¬ ë¡œì§ í™•ì¸
â–¡ ì‚¬ìš©ìì—ê²Œ ìˆ˜ì • ë‚´ìš© ì„¤ëª…
â–¡ ì‚¬ìš©ì ìŠ¹ì¸ ëŒ€ê¸°
â–¡ ìŠ¹ì¸ í›„ ì‘ì—… ì§„í–‰
â–¡ í…ŒìŠ¤íŠ¸ ê³„íš ìˆ˜ë¦½
```

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:** 2025-12-26

**ì‘ì„±ì:** AI Assistant (Antigravity)

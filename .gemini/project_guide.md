# 프로젝트 가이드 (AI 모델용)

이 프로젝트는 **키움증권 자동매매 봇**입니다.

---

## 🚨 **필수 읽기 문서 (우선순위 순)**

### **1. 전략별_설정_팩터_기술서.md** (최우선)
```
위치: ../전략별_설정_팩터_기술서.md
내용: 모든 설정 팩터의 의미, 기본값, 추천값, 코드 적용 위치, 상호작용
중요도: ⭐⭐⭐⭐⭐
```

**왜 먼저 읽어야 하는가:**
- 시스템의 모든 설정 파라미터를 이해할 수 있음
- 코드 수정 시 어떤 팩터를 건드려야 하는지 파악 가능
- 팩터 간 상호작용 및 충돌 방지 가능

---

### **2. 불타기_물타기_전략_가이드.md**
```
위치: ../불타기_물타기_전략_가이드.md
내용: FIRE/WATER 전략 개요, 프리셋 설정, 실전 예시
중요도: ⭐⭐⭐⭐⭐
```

**왜 읽어야 하는가:**
- 매매 전략의 핵심 로직 이해
- 불타기(FIRE)와 물타기(WATER)의 차이점 파악
- 프리셋 자동 설정 시스템 이해

---

### **3. 미체결_로직_기술서.md**
```
위치: ../미체결_로직_기술서.md
내용: 미체결 주문 처리 로직, 매수/매도 시 주문 관리
중요도: ⭐⭐⭐⭐
```

**왜 읽어야 하는가:**
- 주문 충돌 방지 로직 이해
- stocks_being_sold 세트 관리 방식 파악
- 안전한 주문 처리 메커니즘 이해

---

### **4. 트러블슈팅_가이드.md** (문제 발생 시)
```
위치: ../트러블슈팅_가이드.md
내용: 매수/매도/설정/API/봇 문제 해결, 긴급 상황 대응, 로그 분석
중요도: ⭐⭐⭐⭐⭐
```

**왜 읽어야 하는가:**
- 실전 운영 중 발생하는 모든 문제 해결 방법 제공
- 긴급 상황 대응 절차 파악
- 로그 분석 및 디버깅 방법 이해

---

### **5. README.md**
```
위치: ../README.md
내용: 프로젝트 전체 구조, 사용법, 명령어
중요도: ⭐⭐⭐
```

**왜 읽어야 하는가:**
- 프로젝트 전체 구조 파악
- 텔레그램 명령어 및 사용법 이해
- 설치 및 실행 방법 확인

---

## 📂 **핵심 코드 파일**

### **매수/매도 로직**
```
check_n_buy.py:
  - 매수 로직
  - initial_buy_ratio 적용 (1차 10% 테스트)
  - split_buy_cnt 적용 (분할 횟수)
  - FIRE/WATER 전략 구분

check_n_sell.py:
  - 매도 로직
  - TS (트레일링 스탑)
  - 타임컷 (기회비용 최소화)
  - 손절/익절
  - 물타기 보호 (매집 중 손절 스킵)
```

### **설정 관리**
```
settings_ui.py:
  - 설정 UI
  - 프리셋 자동 적용 (apply_preset)
  - 전략별 최적 팩터 조합

database_helpers.py:
  - 설정값 DB 저장/로드
  - get_all_settings, save_all_settings

get_setting.py:
  - 설정값 동적 로드
  - cached_setting (실시간 반영)
```

### **봇 제어**
```
bot.py:
  - 메인 루프
  - 매매 로직 통합
  - 안전 관리 (monitor_safety)

chat_command.py:
  - 텔레그램 명령어 처리
  - 청산 로직 (sell_all_stocks)
  - 일일 손실 한도 체크
```

---

## 🎯 **중요 설계 원칙**

### **1. 설정 우선순위**
```
DB (trading.db) > 기본값
  └─ cached_setting()으로 실시간 반영
  └─ UI에서 변경 시 즉시 적용
```

### **2. 전략별 자동 설정**
```
프리셋 선택 시:
  └─ split_buy_cnt, initial_buy_ratio, stop_loss_rate 등 자동 설정
  └─ settings_ui.py의 apply_preset() 참고
```

### **3. 미체결 주문 관리**
```
매도 중 종목 = 매수 금지
  └─ stocks_being_sold 세트로 관리
  └─ check_n_buy.py에서 체크
```

### **4. 초기 매수 비율**
```
initial_buy_ratio:
  └─ 1차 매수 금액 = alloc_per_stock × cumulative_ratios[0] × initial_buy_ratio
  └─ 불타기: 10% 테스트 → +3% 달성 → 90% 집중
```

---

## ⚠️ **코드 수정 시 주의사항**

### **1. 팩터 변경 시**
```
반드시 확인:
  - 전략별_설정_팩터_기술서.md의 "팩터 간 상호작용" 섹션
  - 다른 팩터에 미치는 영향
  - 프리셋 값과의 일관성
```

### **2. 매수/매도 로직 수정 시**
```
반드시 확인:
  - 미체결_로직_기술서.md의 주문 처리 흐름
  - stocks_being_sold 관리
  - accumulated_purchase_amt 동기화
```

### **3. 전략 로직 수정 시**
```
반드시 확인:
  - 불타기_물타기_전략_가이드.md의 전략 개요
  - FIRE vs WATER 조건 분기
  - 손절 보호 로직 (물타기)
```

---

## 📊 **팩터 요약 (빠른 참조)**

| 팩터 | 불타기 | 물타기 | 코드 위치 |
|------|--------|--------|-----------|
| **split_buy_cnt** | 2 | 10 | check_n_buy.py:206 |
| **initial_buy_ratio** | 10% | 10% | check_n_buy.py:312 |
| **single_stock_rate** | +3% | -1% | check_n_buy.py:235 |
| **stop_loss_rate** | -5% | -10% | check_n_sell.py:24 |
| **TS_ACTIVATION** | 1.5% | 1.5% | check_n_sell.py:29 |
| **TS_CALLBACK** | 0.5% | 0.7% | check_n_sell.py:31 |
| **time_cut_minutes** | 30 | 5 | check_n_sell.py:110 |

---

## 🔍 **문제 해결 가이드**

**상세한 문제 해결 방법은 `트러블슈팅_가이드.md`를 참고하세요!**

### **빠른 체크리스트:**

#### **매수가 안 됨**
```
1. stocks_being_sold 확인
2. 미체결 매도 주문 확인
3. 종목 수 제한 확인
4. 예수금 확인
5. 전략 조건 확인

→ 상세: 트러블슈팅_가이드.md > 1. 매수 관련 문제
```

#### **매도가 안 됨**
```
1. 물타기 매집 완료 여부 확인
2. 매도 조건 확인
3. 미체결 매수 주문 확인

→ 상세: 트러블슈팅_가이드.md > 2. 매도 관련 문제
```

#### **설정이 반영 안 됨**
```
1. DB 저장 확인
2. '💾 설정 저장' 클릭 확인
3. 봇 재시작

→ 상세: 트러블슈팅_가이드.md > 3. 설정 관련 문제
```

#### **긴급 상황**
```
전량 매도: python sell_all_stocks.py
봇 중지: python stop.py
DB 복구: 트러블슈팅_가이드.md > 6. 긴급 상황 대응
```

---

## 📅 **문서 업데이트 날짜**

```
- 전략별_설정_팩터_기술서.md: 2025-12-26
- 불타기_물타기_전략_가이드.md: 2025-12-26
- 미체결_로직_기술서.md: 2025-12-26
- 트러블슈팅_가이드.md: 2025-12-26
- README.md: 2025-12-26 (AI 섹션 추가)
```

---

**⚠️ 이 문서들을 읽지 않고 코드를 수정하면 전략 로직이 깨질 수 있습니다!**

**💡 Tip: 코드 수정 전에 항상 관련 기술 문서를 먼저 확인하세요.**

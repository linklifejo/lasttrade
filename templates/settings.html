<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™˜ê²½ì„¤ì • - LASTTRADE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
            font-family: 'Segoe UI', Arial, sans-serif;
            padding: 40px 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #4a9eff;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #aaa;
            margin-bottom: 40px;
        }

        .section {
            background: rgba(45, 45, 45, 0.8);
            border: 2px solid #555;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .section h2 {
            color: #10b981;
            font-size: 1.8rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .field {
            margin-bottom: 25px;
        }

        .field label {
            display: block;
            color: #4a9eff;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .field input {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            background: #1a1a1a;
            color: #ffffff;
            border: 2px solid #555;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            transition: border-color 0.3s;
        }

        .field input:focus {
            outline: none;
            border-color: #4a9eff;
        }

        .field .desc {
            color: #888;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .back-link {
            display: inline-block;
            color: #4a9eff;
            text-decoration: none;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .status.success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            color: #10b981;
        }

        .status.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #ef4444;
        }
    </style>
</head>

<body>
    <div class="container">
        <a href="/" class="back-link">â† ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>

        <h1>ğŸ”‘ í™˜ê²½ì„¤ì • ë° ì¸ì¦ ì •ë³´</h1>
        <p class="subtitle">ì‹œìŠ¤í…œ ì„¤ì • ë° API ì¸ì¦ ì •ë³´ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤</p>

        <div class="section">
            <h2>ğŸ” ì‹¤ì „ íˆ¬ì ì¸ì¦ ì •ë³´</h2>

            <div class="field">
                <label>ì‹¤ì „ App Key</label>
                <input type="text" id="real_app_key" placeholder="í•œêµ­íˆ¬ìì¦ê¶Œ ì‹¤ì „ ì•± í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <div class="desc">KIS ì‹¤ì „ ì£¼ì‹ ê±°ë˜ìš© ì•± í‚¤</div>
            </div>

            <div class="field">
                <label>ì‹¤ì „ App Secret</label>
                <input type="password" id="real_app_secret" placeholder="í•œêµ­íˆ¬ìì¦ê¶Œ ì‹¤ì „ ì•± ì‹œí¬ë¦¿ì„ ì…ë ¥í•˜ì„¸ìš”">
                <div class="desc">KIS ì‹¤ì „ ì£¼ì‹ ê±°ë˜ìš© ì•± ì‹œí¬ë¦¿</div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ§ª ëª¨ì˜ íˆ¬ì ì¸ì¦ ì •ë³´</h2>

            <div class="field">
                <label>ëª¨ì˜ App Key</label>
                <input type="text" id="paper_app_key" placeholder="í•œêµ­íˆ¬ìì¦ê¶Œ ëª¨ì˜ ì•± í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <div class="desc">KIS ëª¨ì˜ íˆ¬ììš© ì•± í‚¤</div>
            </div>

            <div class="field">
                <label>ëª¨ì˜ App Secret</label>
                <input type="password" id="paper_app_secret" placeholder="í•œêµ­íˆ¬ìì¦ê¶Œ ëª¨ì˜ ì•± ì‹œí¬ë¦¿ì„ ì…ë ¥í•˜ì„¸ìš”">
                <div class="desc">KIS ëª¨ì˜ íˆ¬ììš© ì•± ì‹œí¬ë¦¿</div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“± í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì„¤ì •</h2>

            <div class="field">
                <label>í…”ë ˆê·¸ë¨ ë´‡ í† í°</label>
                <input type="text" id="telegram_token" placeholder="@BotFatherì—ì„œ ë°œê¸‰ë°›ì€ í† í°">
                <div class="desc">í…”ë ˆê·¸ë¨ ë´‡ í† í° (ì˜ˆ: 1234567890:ABCdefGHIjklMNOpqrsTUVwxyz)</div>
            </div>

            <div class="field">
                <label>í…”ë ˆê·¸ë¨ ì±„íŒ… ID</label>
                <input type="text" id="telegram_chat_id" placeholder="ì•Œë¦¼ì„ ë°›ì„ ì±„íŒ… ID">
                <div class="desc">ë³¸ì¸ì˜ í…”ë ˆê·¸ë¨ ì±„íŒ… ID (ìˆ«ì)</div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ’¼ ê³„ì¢Œ ì •ë³´</h2>

            <div class="field">
                <label>ê³„ì¢Œë²ˆí˜¸</label>
                <input type="text" id="my_account" placeholder="ê³„ì¢Œë²ˆí˜¸ (8~12ìë¦¬)">
                <div class="desc">í•œêµ­íˆ¬ìì¦ê¶Œ ê³„ì¢Œë²ˆí˜¸ (ëª¨ì˜/ì‹¤ì „ í†µí•© ê´€ë¦¬)</div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“Š íŠ¸ë ˆì´ë”© ì „ëµ ì„¤ì •</h2>

            <div class="field">
                <label>ëª©í‘œ ë³´ìœ  ì¢…ëª© ìˆ˜ (Target Stock Count)</label>
                <input type="number" id="target_stock_count" placeholder="ì˜ˆ: 5" min="1" max="20">
                <div class="desc">ë™ì‹œì— ìš´ìš©í•  ìµœëŒ€ ì¢…ëª© ìˆ˜ (ì˜ˆìˆ˜ê¸ˆì— ë§ì¶° ìë™ ìµœì í™”ë  ìˆ˜ ìˆìŒ)</div>
            </div>
        </div>

        <button class="btn" onclick="saveSettings()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>

        <div class="status" id="status"></div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ì¡´ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const res = await fetch('/api/settings');
                const settings = await res.json();

                document.getElementById('real_app_key').value = settings.real_app_key || '';
                document.getElementById('real_app_secret').value = settings.real_app_secret || '';
                document.getElementById('paper_app_key').value = settings.paper_app_key || '';
                document.getElementById('paper_app_secret').value = settings.paper_app_secret || '';
                document.getElementById('telegram_token').value = settings.telegram_token || '';
                document.getElementById('telegram_chat_id').value = settings.telegram_chat_id || '';
                document.getElementById('my_account').value = settings.my_account || '';
                document.getElementById('target_stock_count').value = settings.target_stock_count || '5';

                console.log('âœ… ì„¤ì • ë¡œë“œ ì™„ë£Œ');
            } catch (e) {
                console.error('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', e);
                showStatus('ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + e.message, 'error');
            }
        });

        // [UI Auto-Sync] ì„¤ì • ìë™ ë™ê¸°í™” (1ì´ˆë§ˆë‹¤ - ì¦‰ê° ë°˜ì‘)
        setInterval(syncSettings, 1000);

        async function syncSettings() {
            try {
                // ì €ì¥ ë²„íŠ¼ì´ ëˆŒë ¤ìˆì„ ë•ŒëŠ” ë™ê¸°í™” ìŠ¤í‚µ (ì‚¬ìš©ì ì…ë ¥ ë°©í•´ ë°©ì§€)
                const btn = document.querySelector('.btn');
                if (btn.disabled) return;

                const res = await fetch('/api/settings');
                const settings = await res.json();

                // íƒ€ê²Ÿ ì¢…ëª© ìˆ˜ ë™ê¸°í™”
                const elTarget = document.getElementById('target_stock_count');
                const newVal = settings.target_stock_count || '5';

                if (elTarget.value != newVal) {
                    // ê°’ì´ ë‹¤ë¥¼ ë•Œë§Œ ì—…ë°ì´íŠ¸ (ì‚¬ìš©ìê°€ ì…ë ¥ ì¤‘ì´ì§€ ì•Šì„ ë•Œ)
                    if (document.activeElement !== elTarget) {
                        elTarget.value = newVal;
                        showStatus('ğŸ”„ [ì•Œë¦¼] ì¢…ëª© ìˆ˜ê°€ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë˜ì—ˆìŠµë‹ˆë‹¤ (' + newVal + 'ê°œ)', 'success');
                    }
                }
            } catch (e) {
                // ì¡°ìš©íˆ ì‹¤íŒ¨
            }
        }

        async function saveSettings() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'ğŸ’¾ ì €ì¥ ì¤‘...';

            try {
                const settings = {
                    real_app_key: document.getElementById('real_app_key').value,
                    real_app_secret: document.getElementById('real_app_secret').value,
                    paper_app_key: document.getElementById('paper_app_key').value,
                    paper_app_secret: document.getElementById('paper_app_secret').value,
                    telegram_token: document.getElementById('telegram_token').value,
                    telegram_chat_id: document.getElementById('telegram_chat_id').value,
                    my_account: document.getElementById('my_account').value,
                    target_stock_count: document.getElementById('target_stock_count').value
                };

                const res = await fetch('/api/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });

                if (res.ok) {
                    showStatus('âœ… ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    btn.textContent = 'âœ… ì €ì¥ ì™„ë£Œ!';

                    // [UX] ì €ì¥ ì§í›„ ì„œë²„ì—ì„œ ê³„ì‚°ëœ ìµœì‹  ê°’(ì¢…ëª© ìˆ˜ ë“±)ì„ ì¦‰ì‹œ ë¶ˆëŸ¬ì™€ì„œ í™”ë©´ ê°±ì‹ 
                    await syncSettings();

                    setTimeout(() => {
                        btn.textContent = 'ğŸ’¾ ì €ì¥í•˜ê¸°';
                        btn.disabled = false;
                    }, 2000);
                } else {
                    throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
                }
            } catch (e) {
                showStatus('âŒ ì €ì¥ ì‹¤íŒ¨: ' + e.message, 'error');
                btn.textContent = 'ğŸ’¾ ì €ì¥í•˜ê¸°';
                btn.disabled = false;
            }
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + type;
            status.style.display = 'block';

            setTimeout(() => {
                status.style.display = 'none';
            }, 5000);
        }
    </script>
</body>

</html>